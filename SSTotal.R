#1
uk=uTk
kk=kstock
kc=depkc*(1+sum(1-exp((1:n)-n)))
yk=prk*(kk*uk)
inck=yk-ink
ink=depkk
depkc=inck
depkk=kk/(1+sum(1-exp((1:n)-n)))
Nk=Ntot-Nc
uc=uTc
Nc=uc*kc/lk
Ntot=LF*(1-u)
Aprk=yk/Nk
Aprc=yc/Nc
yc=kc*uc*prk
lk=(uc*kc+uk*kk)/Ntot
#Calib
uTk=0.8
uTc=0.8
uTi=0.8
prk=0.3
LF=1000
u=0.07
n=20
kstock=100
#1
Wc=wage
Wk=wage
pc=(1+phic)*UCc
pk=UCk/(1-(rkT*kk)/yk)
UCc=Wc/(prk*lk)
UCk=Wk/(prk*lk)
phic=(rcT*pk*kc)/(UCc*yc)
phik=(rkT*pk*kk)/(UCk*yk)
omegaTc=Wc/pc
omegaTk=Wk/pc
YDw=Wc*Nc+Wk*Nk
Ik=ink*pk
Ic=inck*pk
Yk=yk*pk 
ydw=YDw/pc
cw=Cw/pc
Cw=YDw
Vw=vw*pc
vw=(cw-xiw1*ydw)/xiw2
Mw=Vw
cc=yc-cw
Cc=cc*pc
Yc=Cc+Cw
YDc=Cc
ydc=YDc/pc
vc=(cc-xic1*ydc)/xic2
Vc=vc*pc
YPc=YDc
ws=(Wc*Nc+Wk*Nk)/(Yc+Yk) 
rcT=rkT
#CALIB
#ws=0.6
xic1=0.6
xic2=0.1
xiw1=0.7
xiw2=0.2
wage=10
rkT=0.096
#1
Mc=McD+McDfss
Vec=Vc-McD
Ms=Mc+Mw
rlc=rlcss
rlk=rlkss
Fc=Yc-Wc*Nc-rlc*Lc
Fk=rck*(pk*kk)
FDk=Fk-Ik
FDc=Fc-Ic
Lc=Ld-Lk
Lk=(Yk-Wk*Nk-Fk)/rlk
FDb=rlc*Lc+rlk*Lk
ec=ecss
ek=ekss
Ld=Ms
rck=log(rl/(rlk-rl)-1)/kappa+rb
rcc=(-kk*pk*rb*rlc^2+kk*pk*rb*rlc*rlk-Ld*rl*rlc*rlk+Ld*rlc*rlk^2-Nc*rl*rlk*Wc+Nc*rlk^2*Wc-Nk*rl*rlc*Wk+Nk*rlc*rlk*Wk+rl*rlk*Yc-rlk^2*Yc+rl*rlc*Yk-rlc*rlk*Yk)/(pk*(kk*rl*rlc-kk*rlc^2+kc*rl*rlk-kc*rlk^2))
rccb=Fc/(pk*kc)
lambda20s=1-(lambda10s+lambda30s)
lambda30s=(1-lambda10s)*kk/(kc+kk)
kappa=log(rl/(rlc-rl)-1)/(rcc-rb)
McD=beta*Cc
#Calib
lambda10s=0.1
McDfss=500
ecss=100
ekss=50
rlcss=0.04
rlkss=0.04
rl=0.03
beta=0.3
rb=0.073
x3 = (lambda10s*Vec-McDfss)
x4 = (chi1a*FDc+chi1a*Fc)
x5 = (chi1a*FDk+chi1a*Fk)
# Ec1=(1/(2*(x4-x5)))*(2*lambda20s*Vec*x4+lambda30s*Vec*x4+4*x3*x4-lambda20s*Vec*x5+2*x3*x5-sqrt(-4*(lambda20s^2*Vec^2*x4+lambda20s*lambda30s*Vec^2*x4+4*lambda20s*Vec*x3*x4+3*lambda30s*Vec*x3*x4+3*x3^2*x4)*(x4-x5)+(-2*lambda20s*Vec*x4-lambda30s*Vec*x4-4*x3*x4+lambda20s*Vec*x5-2*x3*x5)^2))
# Ek1=lambda20s*Vec+lambda30s*Vec+x3-(lambda20s*Vec*x4)/(x4-x5)-(lambda30s*Vec*x4)/(2*(x4-x5))-(2*x3*x4)/(x4-x5)+(lambda20s*Vec*x5)/(2*(x4-x5))-(x3*x5)/(x4-x5)+(1/(2*(x4-x5)))*(sqrt(-4*(lambda20s^2*Vec^2*x4+lambda20s*lambda30s*Vec^2*x4+4*lambda20s*Vec*x3*x4+3*lambda30s*Vec*x3*x4+3*x3^2*x4)*(x4-x5)+(-2*lambda20s*Vec*x4-lambda30s*Vec*x4-4*x3*x4+lambda20s*Vec*x5-2*x3*x5)^2))
# Ec2=(1/(2*(x4-x5)))*(2*lambda20s*Vec*x4+lambda30s*Vec*x4+4*x3*x4-lambda20s*Vec*x5+2*x3*x5+sqrt(-4*(lambda20s^2*Vec^2*x4+lambda20s*lambda30s*Vec^2*x4+4*lambda20s*Vec*x3*x4+3*lambda30s*Vec*x3*x4+3*x3^2*x4)*(x4-x5)+(-2*lambda20s*Vec*x4-lambda30s*Vec*x4-4*x3*x4+lambda20s*Vec*x5-2*x3*x5)^2))
# Ek2=lambda20s*Vec+lambda30s*Vec+x3-(lambda20s*Vec*x4)/(x4-x5)-(lambda30s*Vec*x4)/(2*(x4-x5))-(2*x3*x4)/(x4-x5)+(lambda20s*Vec*x5)/(2*(x4-x5))-(x3*x5)/(x4-x5)-(1/(2*(x4-x5)))*(sqrt(-4*(lambda20s^2*Vec^2*x4+lambda20s*lambda30s*Vec^2*x4+4*lambda20s*Vec*x3*x4+3*lambda30s*Vec*x3*x4+3*x3^2*x4)*(x4-x5)+(-2*lambda20s*Vec*x4-lambda30s*Vec*x4-4*x3*x4+lambda20s*Vec*x5-2*x3*x5)^2))
Ec1=1/(2*(2*x4-2*x5))*(4*lambda20s*Vec*x4+2*lambda30s*Vec*x4+5*x3*x4-2*lambda20s*Vec*x5+x3*x5-sqrt(-4*(2*lambda20s^2*Vec^2*x4+2*lambda20s*lambda30s*Vec^2*x4+5*lambda20s*Vec*x3*x4+3*lambda30s*Vec*x3*x4+3*x3^2*x4)*(2*x4-2*x5)+(-4*lambda20s*Vec*x4-2*lambda30s*Vec*x4-5*x3*x4+2*lambda20s*Vec*x5-x3*x5)^2))
Ek1=lambda20s*Vec+lambda30s*Vec+x3-(2*lambda20s*Vec*x4)/(2*x4-2*x5)-(lambda30s*Vec*x4)/(2*x4-2*x5)-(5*x3*x4)/(2*(2*x4-2*x5))+(lambda20s*Vec*x5)/(2*x4-2*x5)-(x3*x5)/(2*(2*x4-2*x5))+(1/(2*(2*x4-2*x5)))*(sqrt(-4*(2*lambda20s^2*Vec^2*x4+2*lambda20s*lambda30s*Vec^2*x4+5*lambda20s*Vec*x3*x4+3*lambda30s*Vec*x3*x4+3*x3^2*x4)*(2*x4-2*x5)+(-4*lambda20s*Vec*x4-2*lambda30s*Vec*x4-5*x3*x4+2*lambda20s*Vec*x5-x3*x5)^2))
Ec2=(1/(2*(2*x4-2*x5)))*(4*lambda20s*Vec*x4+2*lambda30s*Vec*x4+5*x3*x4-2*lambda20s*Vec*x5+x3*x5+sqrt(-4*(2*lambda20s^2*Vec^2*x4+2*lambda20s*lambda30s*Vec^2*x4+5*lambda20s*Vec*x3*x4+3*lambda30s*Vec*x3*x4+3*x3^2*x4)*(2*x4-2*x5)+(-4*lambda20s*Vec*x4-2*lambda30s*Vec*x4-5*x3*x4+2*lambda20s*Vec*x5-x3*x5)^2))
Ek2=lambda20s*Vec+lambda30s*Vec+x3-(2*lambda20s*Vec*x4)/(2*x4-2*x5)-(lambda30s*Vec*x4)/(2*x4-2*x5)-(5*x3*x4)/(2*(2*x4-2*x5))+(lambda20s*Vec*x5)/(2*x4-2*x5)-(x3*x5)/(2*(2*x4-2*x5))-1/(2*(2*x4-2*x5))*(sqrt(-4*(2*lambda20s^2*Vec^2*x4+2*lambda20s*lambda30s*Vec^2*x4+5*lambda20s*Vec*x3*x4+3*lambda30s*Vec*x3*x4+3*x3^2*x4)*(2*x4-2*x5)+(-4*lambda20s*Vec*x4-2*lambda30s*Vec*x4-5*x3*x4+2*lambda20s*Vec*x5-x3*x5)^2))
pce=Ec1/ec
pke=Ek1/ek
RRc=x4/(ec*pce)
RRk=x5/(ek*pke)
lambda12s=-x3/(Vec*(RRc+RRk))
lambda33s=-3*lambda12s/2
lambda22s=lambda33s
lambda13s=lambda12s
lambda32s=-(lambda33s+lambda13s)
rc=FDc/(ec*pce)
rk=FDk/(ek*pke)
lambda23s=lambda32s
eta0c=(-eta3*qc-eta1*uTc+eta2*rrlc*lambdac)
lambdac=Lc/(pk*kc)
qc=ec*pce/(pk*kc)
eta0k=(-eta3*qk-eta1*uTk+eta2*rrlk*lambdak)
lambdak=Lk/(pk*kk)
qk=ek*pke/(pk*kk)
rrlc=rlc
rrlk=rlk
Omega2=(omegaTk-Omega0-Omega1*log(Aprc))/log(Ntot/LF)
lambda11s=-lambda13s-lambda12s-lambda13s
#Calibration
Omega3=0.5
eta1=0.05
eta2=1.25
eta3=0.05
Omega0=0.3
Omega1=0.1
#Shock and free parameters
pri=gain*prk
gain=1.1
epsilon=0.25
theta=0.25
chi=0.25
nu=0.25
psik=10
psic=10
psii=10
chi1=0.375
chi1b=0.25
rho=0.03
tau=0.01
nLoans=5
eta0i=0.06
eta3i=0.01
entry=20
back=4
zeta=0.1
eta=0
#CALIB
# #RealSS
# chi=0.25
# nu=0.25
# Psik=10
# Psic=10
# Psii=10
# xi1a=1/3
# xi1=0.375
# xi1b=0.25
# lambda10s=0.1
# McDfss=500
# nLoans=5
# lk=0.400888
# li=0.400888
# rcT=0.096
# rkT=0.096
# riT=0.096
chi1a=1/3
exitk=0
irrational=0
irrational2=0
irrational3=0.08
irrational4=0
t=0
timeline 1 3