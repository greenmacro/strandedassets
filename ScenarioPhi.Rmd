---
title: "Phi Scenario Analysis"
author: "Antoine Godin"
date: "25 October 2017"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
load("PhiAnalysis.Rdata")
library(knitr)
library(plotrix)
```

# Transition from brown to green

We are here in the case of different blindness (i.e. different $\phi$) but identical apathy (same $\theta=0.2$). We compare scenario 34 (success case of a transition with $\phi=1$) and scenario 27 (failing case of a transition with $\phi=0.3$) of the Phi sensitivity analysis (33 scenarios combining $\theta \in \left\{0,0.1,0.2\right\}$ and  $\phi \in \left\{0,0.1,0.2,...,0.9,1\right\}$) . The success/fail caracteristics regards the existence of a large or small recession at the end of the transition, which takes place anyway.

As for the case of the no-transition scenario, the entry of the low-carbon sector lead to a re-allocation of financial assets which have an impact on the growth rate of consumption and high-carbon sectors. The following table shows the difference in expected present value and equity price due to higher blindness (positive value implies higher value in the blinder, more successful, case).

```{r, echo=FALSE}
tempf<-fail[22:25,c("kllperc","khh","khhperc","PVyl","PVyh","phe","pce","gkh","gc")]
temp<-suc[22:25,c("kllperc","khh","khhperc","PVyl","PVyh","phe","pce","gkh","gc")]
dif<-round(temp-tempf,digit=5)
kable(cbind(dif))
```

This leads to different growth rate in each sector, leading to different investment decision. Overall, the impact is positive in terms of output, employment and labor income. This dyanmic is reinforced as the observed growth rates feed into the financial appreciation of potential value for capital stocks. Furthermore, higher labor income leads to increased consumption and reverts the initial negative impact on the consumption sector.

Once this happens, the expected growth rate in the consumption sector takes over the expected growth rates in the brown capital scetor and we observe a reversal of the trends: reduced (and eventually negative) growth in the capital sector, decrease in output and employment. Note that this has no effect on the green sector.

```{r, echo=FALSE}

tempf<-fail[21:61,c("Yc","Yh","Yl")]
tempf$GDP<-tempf$Yc+tempf$Yh+tempf$Yl
temp<-suc[21:61,c("Yc","Yh","Yl")]
temp$GDP<-temp$Yc+temp$Yh+temp$Yl

#add legend
dif<-temp-tempf
difpos<-dif[,c("Yc","Yh","Yl")]/temp$GDP
difpos[difpos<0]<-0
difneg<-dif[,c("Yc","Yh","Yl")]/temp$GDP
difneg[difneg>0]<-0

#for the ylim, if necessary round(100*min(rowSums(difneg)),digits=1), round(100*max(rowSums(difpos)),digits=2)
png(filename=paste("plots/final/PhiGDP.png",sep=""),width=1440,height=960,pointsize = 20)
df.bar<-barplot(100*t(as.matrix(difpos)), main="", xlab="", ylim=c(-1,0.35), border="white", col=c("lightblue","lightcoral","lightgreen"))
df.bar<-barplot(100*t(as.matrix(difneg)), main="", xlab="", add=TRUE, border="white", col=c("lightblue","lightcoral","lightgreen"), axes=F)
points(x = df.bar, y=100*dif$GDP/temp$GDP,lwd=1,pch=5)
legend("bottomleft", legend=c("Consumption","High-Carbon","Low-Carbon"), bty='n', col=c("lightblue","lightcoral","lightgreen"), fill=c("lightblue","lightcoral","lightgreen"), border="white")
grid()
abline(v=mean(df.bar[21:22]),col=2,lty=2)
legend(x=-1.35,y=-0.785,legend=c("Difference in GDP"),bty='n',col=c(1),pch=5,x.intersp = 1.3)
dev.off()
```

The effact on the capital stock are more striking, more blindness leaves the economy with a lower capital stock in the brown sector and a slightly higher capital stock in the consumption sector, as a result of the dynamics we described hereabove. Overall, the economy has a lower GDP and a lower stock of capital.

```{r, echo=FALSE}
tempf<-fail[21:61,c("khc","klc","khh","kll","khl")]
tempf$capStock<-rowSums(tempf)
tempf$cStock<-rowSums(tempf[c("khc","klc")])
tempf$lStock<-rowSums(tempf[c("khl","kll")])
temp<-suc[21:61,c("khc","klc","khh","kll","khl")]
temp$capStock<-rowSums(temp)
temp$cStock<-rowSums(temp[c("khc","klc")])
temp$lStock<-rowSums(temp[c("khl","kll")])

#add legend
dif<-temp-tempf
difpos<-dif[,c("cStock","khh","lStock")]/temp$capStock
difpos[difpos<0]<-0
difneg<-dif[,c("cStock","khh","lStock")]/temp$capStock
difneg[difneg>0]<-0

#for the ylim, if necessary round(100*min(rowSums(difneg)),digits=1), round(100*max(rowSums(difpos)),digits=2)
png(filename=paste("plots/final/PhiCapStock.png",sep=""),width=1440,height=960,pointsize = 20)
df.bar<-barplot(100*t(as.matrix(difpos)), main="", xlab="", ylim=c(-0.45,0.1), border="white", col=c("lightblue","lightcoral","lightgreen"))
df.bar<-barplot(100*t(as.matrix(difneg)), main="", xlab="", add=TRUE, border="white", col=c("lightblue","lightcoral","lightgreen"), axes=F)
points(x = df.bar, y=100*dif$capStock/temp$capStock,lwd=1,pch=5)
legend("bottomleft", legend=c("Consumption","High-Carbon","Low-Carbon"), bty='n', col=c("lightblue","lightcoral","lightgreen"), fill=c("lightblue","lightcoral","lightgreen"), border="white")
grid()
abline(v=mean(df.bar[21:22]),col=2,lty=2)
legend(x=-1.35,y=-0.36,legend=c("Difference in total capital stock"),bty='n',col=c(1),pch=5,x.intersp = 1.3)
dev.off()
```

Lower capital stock in the aggregate leads to lower debt level (given the targeted leverage level), implying that money holding by households is lower, but this is partially compensated by a higher level of total market capitalisation.

```{r, echo=FALSE}
tempf<-fail[21:61,c("Vw","pce","phe","ple","Mf")]
tempf$pce<-tempf$pce*100
tempf$ple<-tempf$ple*100
tempf$phe<-tempf$phe*50
tempf$totWealth<-rowSums(tempf)
tempf$finWealth<-rowSums(tempf[c("pce","phe","ple")])
tempf$moneyStock<-rowSums(tempf[c("Mf","Vw")])
temp<-suc[21:61,c("Vw","pce","phe","ple","Mf")]
temp$pce<-temp$pce*100
temp$ple<-temp$ple*100
temp$phe<-temp$phe*50
temp$totWealth<-rowSums(temp)
temp$finWealth<-rowSums(temp[c("pce","phe","ple")])
temp$moneyStock<-rowSums(temp[c("Mf","Vw")])


#add legend
dif<-temp-tempf
difpos<-dif[,c("moneyStock","finWealth")]/temp$totWealth
difpos[difpos<0]<-0
difneg<-dif[,c("moneyStock","finWealth")]/temp$totWealth
difneg[difneg>0]<-0

#for the ylim, if necessary round(100*min(rowSums(difneg)),digits=1), round(100*max(rowSums(difpos)),digits=2)
png(filename=paste("plots/final/PhiWealth.png",sep=""),width=1440,height=960,pointsize = 20)
df.bar<-barplot(100*t(as.matrix(difpos)), main="", xlab="", ylim=c(-1,0.6), border="white", col=c("lightblue","lightcoral","lightgreen"))
df.bar<-barplot(100*t(as.matrix(difneg)), main="", xlab="", add=TRUE, border="white", col=c("lightblue","lightcoral","lightgreen"), axes=F)
points(x = df.bar, y=100*dif$totWealth/temp$totWealth,lwd=1,pch=5)
legend("bottomleft", legend=c("Money","Equity"), bty='n', col=c("lightblue","lightcoral","lightgreen"), fill=c("lightblue","lightcoral","lightgreen"), border="white")
grid()
legend(x=-1.35,y=-0.79,legend=c("Difference in total wealth"),bty='n',col=c(1),pch=5,x.intersp = 1.3)
abline(v=mean(df.bar[21:22]),col=2,lty=2)
dev.off()
```

## IPO and after

Once the green sector enters the financial market, most of the dynamics are dominated by the portfolio re-allocation process and its feed-back to real dimensions such as growth, employment, consumption and investment. The fact that the brown capital sector was already smaller means that the shock of the green IPO is relatively lower, leading to a phase where total financial wealth is not as depressed as in the less-blind scenario. However, this is only transitory as soon the reality of real capital stock levels drags down the market capitalisation of all firms into level lower in the blinder case.


```{r, echo=FALSE}
tempf<-fail[21:61,c("pce","phe","ple","Vfe")]
tempf$pce<-tempf$pce*100
tempf$ple<-tempf$ple*100
tempf$phe<-tempf$phe*50
temp<-suc[21:61,c("pce","phe","ple","Vfe")]
temp$pce<-temp$pce*100
temp$phe<-temp$phe*100
temp$ple<-temp$ple*50

#add legend
dif<-temp-tempf
difpos<-dif[c("pce","phe","ple")]/temp$Vfe
difpos[difpos<0]<-0
difneg<-dif[c("pce","phe","ple")]/temp$Vfe
difneg[difneg>0]<-0

#for the ylim, if necessary round(100*min(rowSums(difneg)),digits=1), round(100*max(rowSums(difpos)),digits=2)
png(filename=paste("plots/final/PhiMarketCap.png",sep=""),width=1440,height=960,pointsize = 20)
df.bar<-barplot(100*t(as.matrix(difpos)), main="", xlab="", ylim=c(-2.3,2.3), border="white", col=c("lightblue","lightcoral","lightgreen"))
df.bar<-barplot(100*t(as.matrix(difneg)), main="", xlab="", add=TRUE, border="white", col=c("lightblue","lightcoral","lightgreen"), axes=F)
points(x = df.bar, y=100*dif$Vfe/temp$Vfe,lwd=1,pch=5)
legend("bottomleft", legend=c("Consumption Equity","High-Carbon Equity","Low-Carbon Equity"), bty='n', col=c("lightblue","lightcoral","lightgreen"), fill=c("lightblue","lightcoral","lightgreen"), border="white")
grid()
abline(v=mean(df.bar[21:22]),col=2,lty=2)
legend(x=-1.35,y=-1.55,legend=c("Difference in financial wealth"),bty='n',col=c(1),pch=5,x.intersp = 1.3)
dev.off()
```

On the flow side, the situation pre-IPO remain the norm, i.e. lower consumption and overal lower investment in brown capital. The overall lower level even leads to lower green investment towards the end of the transition.

```{r, echo=FALSE}
tempf<-fail[40:63,c("Yc","Yh","Yl")]
tempf$GDP<-tempf$Yc+tempf$Yh+tempf$Yl
temp<-suc[40:63,c("Yc","Yh","Yl")]
temp$GDP<-temp$Yc+temp$Yh+temp$Yl

#add legend
dif<-temp-tempf
difpos<-dif[,c("Yc","Yh","Yl")]/temp$GDP
difpos[difpos<0]<-0
difneg<-dif[,c("Yc","Yh","Yl")]/temp$GDP
difneg[difneg>0]<-0

#for the ylim, if necessary round(100*min(rowSums(difneg)),digits=1), round(100*max(rowSums(difpos)),digits=2)

df.bar<-barplot(100*t(as.matrix(difpos)), main="Changes in GDP components as % of GDP", xlab="", ylim=c(-10,10), border="white", col=c("lightblue","lightcoral","lightgreen"))
df.bar<-barplot(100*t(as.matrix(difneg)), main="", xlab="", add=TRUE, border="white", col=c("lightblue","lightcoral","lightgreen"), axes=F)
points(x = df.bar, y=100*dif$GDP/temp$GDP,lwd=1,pch=5)
legend("bottomleft", legend=c("Consumption","High-Carbon","Low-Carbon"), bty='n', col=c("lightblue","lightcoral","lightgreen"), fill=c("lightblue","lightcoral","lightgreen"), border="white")
grid()
legend(x=-2,y=-0.3,legend=c("GDP"),bty='n',col=c(1),pch=5,x.intersp = 1.3)
```

On the stock space, the level of capital stock remains slightly higher in the blinder scenario while the large gap in bropwn capital stock slowly disapears (due to lower decrease in capital stock than in the less-blind scenario). The observed decrease in green investment translates in a lower level of green capital stock.


```{r, echo=FALSE}
tempf<-fail[40:63,c("khc","klc","khh","kll","khl")]
tempf$capStock<-rowSums(tempf)
tempf$cStock<-rowSums(tempf[c("khc","klc")])
tempf$lStock<-rowSums(tempf[c("khl","kll")])
temp<-suc[40:63,c("khc","klc","khh","kll","khl")]
temp$capStock<-rowSums(temp)
temp$cStock<-rowSums(temp[c("khc","klc")])
temp$lStock<-rowSums(temp[c("khl","kll")])

#add legend
dif<-temp-tempf
difpos<-dif[,c("cStock","khh","lStock")]/temp$capStock
difpos[difpos<0]<-0
difneg<-dif[,c("cStock","khh","lStock")]/temp$capStock
difneg[difneg>0]<-0

#for the ylim, if necessary round(100*min(rowSums(difneg)),digits=1), round(100*max(rowSums(difpos)),digits=2)

df.bar<-barplot(100*t(as.matrix(difpos)), main="Changes in capital stocks as % of total capital sctock", xlab="", ylim=c(-3,1), border="white", col=c("lightblue","lightcoral","lightgreen"))
df.bar<-barplot(100*t(as.matrix(difneg)), main="", xlab="", add=TRUE, border="white", col=c("lightblue","lightcoral","lightgreen"), axes=F)
points(x = df.bar, y=100*dif$capStock/temp$capStock,lwd=1,pch=5)
legend("bottomleft", legend=c("Consumption","High-Carbon","Low-Carbon"), bty='n', col=c("lightblue","lightcoral","lightgreen"), fill=c("lightblue","lightcoral","lightgreen"), border="white")
grid()
legend(x=-0.5,y=-0.32,legend=c("Change in total capital stock"),bty='n',col=c(1),pch=5,x.intersp = 1.3)
```

When the brown sector defaults, due to market capitalisation being nul, the economy is thus in a situation where there is less capital stock, less debt and less financial assets in the brown capital sector. This imply that the disappearance of the brown sector is less of a shock and hence allow for a quicker recovery afterwards. The following table shows the relative difference between the two scenario (negative value for lower value in the blinder scenario)

```{r, echo=FALSE}
tempf<-fail[62,c("khh","Loansh","phe")]
tempf$phe<-tempf$phe*50
temp<-suc[62,c("khh","Loansh","phe")]
temp$phe<-temp$phe*50
dif<-round((temp-tempf)/temp,digit=5)
kable(cbind(dif))
```

The interesting conclusion from this scenario analysis is pre-IPO dynamics explain most of the reason for a difference in the amplitude of shock due to the default of the brown sector. The blindness parameter affects at first the consumption sector which launch the economy to a path including a lower level fo GDP and a lower level of stocks. 

