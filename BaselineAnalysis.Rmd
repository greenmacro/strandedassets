---
title: "Baseline Analysis"
author: "Antoine Godin"
date: "24 January 2017"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
load("baselineAnalysis.Rdata")
library(knitr)
library(plotrix)
```

# Transition from brown to green

## Brown Capital Sector

### Entry of Green

When Green sector enters the market, brown capital sees an immediate rise in demand due to green buying brown capital good. This leads to an increase in employment and a decrease in price in the next period due to an increase in capacity utilisation leading to a decrease in the markup (fixed return rate on capital).

```{r,echo=FALSE}
analysis<-bas[21:23,c("yh","invlh","pkh","upsilonh","uh")]
kable(analysis)
```

The decrease in price triggers a decrease in the growth rate of the consumption sector due to an increase in the real interest rate (due to negative inflation), qc and uce remaining to their steady state values. This leads to a decrease in consumption investment in aggregate combined with the fact that the consumoption sector starts investing in green capital.

```{r,echo=FALSE}
analysis<-bas[21:23,c("yh","invch","invyc","invcl","gc","rintrc","intrc","pickhl","lambdacprev","qcprev","uce")]
kable(analysis)
```

### Fail and recovery

After these initial two periods that set up the stage for a period of fluctuations, mainly driven by investment decisions from the consumption sector (and hence consumption decision from households), with lagged feedback mechanisms coming from brown investment decision, pricing and equity pricing impacts.

In general the growth decision of the sector is driven mainly the dynamics of the sectorial Tobins'q (feedback from capital growth rates) and by the leverage and real interest rates (with feedbacks coming from their own capital price). This leads to a few periods of negative growth, until the sector recovers. 

```{r, echo=FALSE}
temp<-bas[21:41,c("lambdahprev","rintrh","qhprev","uhe","intrh","eta2","eta1","eta3","eta0k","gkh")]
temp$debtburden<--temp$eta2*temp$rintrh*temp$lambdahprev
# temp$pik<-temp$pik/temp$pik[1]
temp$capacity<-temp$eta1*temp$uh
temp$finance<-temp$eta3*temp$qhprev
matplot(rownames(temp),temp[c("debtburden","capacity","finance","gkh")],col=2:5,type='l',lty=1,lwd=2,main="factors of brown growth",xlab="",ylab="")
abline(h=0,col=1)
grid()
legend("center",col=2:5,lwd=2,bty='n',legend=c("debtburden","capacity","finance","growth"))
```

### IPO of Green

When the green sector enters the financial market, the other equities (consumption and capital) take a hit, this lead to a rapid decrease in sectorial Tobin's q and hence a decrease in capacity growth.

```{r, echo=FALSE}
temp<-bas[40:45,c("pce","phe","ple")]
kable(temp)
```

The impact of the decrease of equity prices is augmented by a general decrease of output and hence investment coming from the consumption sector (further increased by the increase of green capital availability). This is slightly compensated by the decrease of debt burden, coming out of increase in prices and hence a decrease in the real interest rate. Overall the brown sectors decreases in size.

```{r, echo=FALSE}
temp<-bas[40:53,c("lambdahprev","rintrh","qhprev","uhe","intrh","eta2","eta1","eta3","eta0k","gkh")]
temp$debtburden<--temp$eta2*temp$rintrh*temp$lambdahprev
temp$capacity<-temp$eta1*temp$uhe
temp$finance<-temp$eta3*temp$qhprev
matplot(rownames(temp),temp[c("debtburden","capacity","finance","gkh")],col=2:5,type='l',lty=1,lwd=2,main="factors of brown growth",xlab="",ylab="")
abline(h=0,col=1)
abline(v=53,col=1)
grid()
legend("center",col=2:5,lwd=2,bty='n',legend=c("debtburden","capacity","finance","growth"))
```

The reason for the increase in brown capital price can be found in an overal decrease in capacity utilisation, leading to an increase in mark-up, which is accelerated via the increase in capital value, leading to further increase in prices.

```{r, echo=FALSE}
temp<-bas[40:53,c("pkh","upsilonh","yhe","UChe")]
temp$pkh<-temp$pkh/temp$pkh[1]
temp$upsilonh<-temp$upsilonh/temp$upsilonh[1]
temp$yhe<-temp$yhe/temp$yhe[1]
temp$UChe<-temp$UChe/temp$UChe[1]
matplot(rownames(temp),temp,type='l',lty=1,lwd=2,ylab="",xlab="")
abline(v=53,col=1)
legend("bottomleft",col=1:5,lwd=2,bty='n',legend=c("pkh","upsilonh","yhe","UChe"))
```

### Exit of brown

The overall decrease in brown growth leads to a decrease in potential output percieved by financial investor, combined with an increase in potential output from the green sector and to a lesser extent from the consumption sector.

```{r, echo=FALSE}
temp<-bas[40:53,c("ypotce","ypothe","ypotle")]
temp$ypothe<-temp$ypothe/temp$ypothe[1]
temp$ypotle<-temp$ypotle/temp$ypotle[1]
temp$ypotce<-temp$ypotce/temp$ypotce[1]
matplot(rownames(temp),temp,type='l',lty=1,lwd=2,ylim=c(-1,10),ylab="",xlab="")
abline(h=1)
abline(v=53,col=1)
legend("bottomleft",col=1:5,lwd=2,bty='n',legend=colnames(temp))
```

These transforms directly into change in equity prices until financial investor do not wish to hold brown capital equities which leads to the bankrupcy of the sector (period 59).

```{r, echo=FALSE}
temp<-bas[40:53,c("pce","phe","ple")]
# temp$pie<-temp$pie/temp$pie[1]
# temp$pke<-temp$pke/temp$pke[1]
# temp$pce<-temp$pce/temp$pce[1]
matplot(rownames(temp),temp,type='l',lty=1,lwd=2,ylab="",xlab="")
abline(h=0)
abline(v=53,col=1)
legend("bottomleft",col=1:5,lwd=2,bty='n',legend=colnames(temp))
```

## Green sector

The green sector enters the market and grows at a fixed rate of 10% until it enters the financial market. The sector uses at first little of its output but that share increases as its investments level increases.

```{r, echo=FALSE}
temp<-bas[23:41,c("yl","invcl")]
temp$incishare<-temp$invcl/temp$yl
matplot(rownames(temp),temp$incishare,type='l',lty=1,lwd=2,ylim=c(-1,2),ylab="",xlab="",main="Share of consumption investment")
```

Once the green sector enters the financial market, its Tobin's q increases dramatically, thanks to the high growth rate it has had in the past (and confirmed afterwards). The growth rate is capped a 30%. Once the financial market settles down and the consumption good sector also enjoys high growth, the equity price of the green sector decreases, leading to lower growth rates and further reduction in equity price (see graph hereabove).

```{r, echo=FALSE}
temp<-bas[40:53,c("lambdalprev","rintrl","qlprev","ule","intrl","eta2","eta1","eta3","eta0k","gkl")]
temp$debtburden<--temp$eta2*temp$rintrl*temp$lambdalprev
temp$capacity<-temp$eta1*temp$ule
temp$finance<-temp$eta3*temp$qlprev
matplot(rownames(temp),temp[c("debtburden","capacity","finance","gkl")],col=2:5,type='l',lty=1,lwd=2,main="factors of green growth",xlab="",ylab="",ylim=c(-0.01,0.32))
abline(h=0,col=1)
abline(v=53,col=1)
grid()
legend("center",col=2:5,lwd=2,bty='n',legend=c("debtburden","capacity","finance","growth"))
```

## Consumption sector

### Before financial entry of green sector

As note hereabove, the consumption setor first de-grows due to a decrease in capital prices leading to a real interest rate increase and hence an increase in the debt burden. This is only temporary as consumption increases due to employment increase coming from the other two sectors and in a later stage, the increase of the Tobin's q (due tohigher growth level feeding back into the potential output). The debt burden burden improves also due to the price increase in the brown capital good (higher inflation means lower real interest rates). Capacity utilisation plays a minor role.

```{r, echo=FALSE}
temp<-bas[21:41,c("lambdacprev","rintrc","qcprev","uce","intrc","eta2","eta1","eta3","eta0c","gc")]
temp$debtburden<--temp$eta2*temp$rintrc*temp$lambdacprev
temp$capacity<-temp$eta1*temp$uce
temp$finance<-temp$eta3*temp$qcprev
matplot(rownames(temp),temp[c("debtburden","capacity","finance","gc")],col=2:5,type='l',lty=1,lwd=2,main="factors of consumption growth",xlab="",ylab="")
abline(h=0,col=1)
abline(v=53,col=1)
grid()
legend("center",col=2:5,lwd=2,bty='n',legend=c("debtburden","capacity","finance","growth"))
```

In terms of output, most of the fluctuations come from the consumption out of labor income, with minor fluctuations out of consumption out of capital income (also because it represent a smaller share: `r 100*mean(bas$cf[21:41]/bas$yc[21:41])`%)

```{r, echo=FALSE}
temp<-bas[21:41,c("yc","cf","cw")]
temp$yc<-temp$yc/temp$yc[1]
temp$cf<-temp$cf/temp$cf[1]
temp$cw<-temp$cw/temp$cw[1]
matplot(rownames(temp),temp,type='l',lty=1,lwd=2,ylab="",xlab="")
abline(h=1)
abline(v=53,col=1)
legend("bottomleft",col=1:5,lwd=2,bty='n',legend=colnames(temp))

temp<-bas[21:41,c("cw","cf")]
prop_table <- prop.table(as.matrix(temp),1)
#draw chart
stackpoly(100*prop_table,stack=T,xaxlab=rownames(temp),ylim=c(60,100))
#add legend
legend("topright",c("cw","cf"),fill=rainbow(dim(temp)[2]),bty='n')

```

#### Consumption out of labor income

Completely driven by expected income which somewhat smoothes out the fluctuation in observed disposable income (mimics the employment dynamics mitigated by inflationary effects on wealth).

```{r, echo=FALSE}
temp<-bas[21:41,c("cw","ydwe","pc","ydw","Ntot")]
temp$ydwe<-temp$ydwe/temp$ydwe[1]
temp$cw<-temp$cw/temp$cw[1]
temp$pc<-temp$pc/temp$pc[1]
temp$ydw<-temp$ydw/temp$ydw[1]
temp$Ntot<-temp$Ntot/temp$Ntot[1]
matplot(rownames(temp),temp,type='l',lty=1,lwd=2,ylab="",xlab="")
abline(h=1)
abline(v=59,col=1)
grid()
legend("bottomleft",col=1:6,lwd=2,bty='n',legend=colnames(temp))
```

Employment dynamics are driven by output decision and on the aggregate due to initial growth from consumption and green sectors, falls down due to degrowth in consumption and capital, to finaly recover wheen green growth (and brown growth in a later stage) overcome the employment lost in the consumption sector

```{r, echo=FALSE}
temp<-bas[21:41,c("Nc","Nh","Nl")]
#draw chart
stackpoly(temp,stack=T,xaxlab=rownames(temp),ylim=c(550,1000))
#add legend
legend("bottomleft",c("Nc","Nh","Nl"),fill=rainbow(dim(temp)[2]),bty='n')
```

#### Capital income

Most of the consumption out of capital income and wealth is driven by wealth dynamics (both in levels and capital gains) and to a lesser extend by income dynamics.

```{r, echo=FALSE}
temp<-bas[21:41,c("cf","ydfe","ydf","vf","pc","cg")]
temp$ydf<-temp$ydf/temp$ydf[1]
temp$ydfe<-temp$ydfe/temp$ydfe[1]
temp$cf<-temp$cf/temp$cf[1]
temp$pc<-temp$pc/temp$pc[1]
temp$vf<-temp$vf/(temp$vf[1])
temp$cg<-1+temp$cg/(10e14*temp$cg[1])
matplot(rownames(temp),temp,type='l',lty=1,lwd=2,ylab="",xlab="",ylim=c(0.9,1.1))
abline(h=1)
abline(v=53,col=1)
legend("bottomleft",col=1:6,lwd=2,bty='n',legend=c("cf","ydfe","ydf","vf","pc","cg (divided by 10e14)"))
```

Capital income shows relatively stable banks dividends with large fluctuation between (negatively correlated) consumption and brown dividends. Innovation doesn't distribute dividends.

```{r, echo=FALSE}
temp<-bas[21:41,c("FDb","FDc","FDh","FDl")]
#create proportions table
#draw chart
stackpoly(temp,stack=T,xaxlab=rownames(temp),ylim=c(0,3400))
#add legend
legend("topright",c("FDb","FDc","FDh","FDl"),fill=rainbow(dim(temp)[2]),bty='n')
# matplot(rownames(temp),temp,type='l',lty=1,lwd=2,ylab="",xlab="")
# abline(h=1)
# abline(v=59,col=1)
# legend("bottomleft",col=1:6,lwd=2,bty='n',legend=c("FDb","FDc","FDk","FDi"))
```

### IPO of green

The green IPO leads to an overall decrease in equity price of the consumption sector which leads to a decrease of the consumption growth via a decrease of Tobin's q, dampened by capacity utilisation (mainly from decrase in capital stock) and debt burden (via real interest rate)

```{r, echo=FALSE}
temp<-bas[41:53,c("lambdacprev","rintrc","qcprev","uce","intrc","eta2","eta1","eta3","eta0c","gc")]
temp$debtburden<--temp$eta2*temp$rintrc*temp$lambdacprev
temp$capacity<-temp$eta1*temp$uce
temp$finance<-temp$eta3*temp$qcprev
matplot(rownames(temp),temp[c("debtburden","capacity","finance","gc")],col=2:5,type='l',lty=1,lwd=2,main="factors of consumption growth",xlab="",ylab="")
abline(h=0,col=1)
abline(v=53,col=1)
grid()
legend("center",col=2:5,lwd=2,bty='n',legend=c("debtburden","capacity","finance","growth"))
```

Output sees a decrease of labour income consumption more than compensated by an increase out of capital income consumption. The latter then fluctuates while the labor income consumption slowly recovers as employment increase.

```{r, echo=FALSE}
temp<-bas[41:53,c("yc","cf","cw")]
temp$yc<-temp$yc/temp$yc[1]
temp$cf<-temp$cf/temp$cf[1]
temp$cw<-temp$cw/temp$cw[1]
matplot(rownames(temp),temp,type='l',lty=1,lwd=2,ylab="",xlab="")
abline(h=1)
abline(v=53,col=1)
legend("bottomleft",col=1:5,lwd=2,bty='n',legend=colnames(temp))
```

#### Consumption out of labor income

Completely driven by expected income which somewhat smoothes out the fluctuation in observed disposable income (mimics the employment dynamics mitigated by inflationary effects on wealth). NOte that full employment constraints binds leading to forced decrease in consumption. The sudden increase in consumption comes from the decrease in brown capital employment, allowing for more output to be produced.

```{r, echo=FALSE}
temp<-bas[40:53,c("ydwe","xiw1","xiw2","vw")]
temp$ydwe<-temp$xiw1*temp$ydwe
temp$vw<-c(NA,temp$xiw2[-14]*temp$vw[-14])
temp<-temp[-1,c("ydwe","vw")]
stackpoly(temp,stack=T,xaxlab=rownames(temp))
lines(bas$cw[41:53],lwd=2)
#add legend
legend("bottomleft",c("ydfe","vf"),fill=rainbow(dim(temp)[2]),bty='n')
# temp<-bas[41:59,c("cw","ydwe","pc","ydw","Ntot")]
# temp$ydwe<-temp$ydwe/temp$ydwe[1]
# temp$cw<-temp$cw/temp$cw[1]
# temp$pc<-temp$pc/temp$pc[1]
# temp$ydw<-temp$ydw/temp$ydw[1]
# temp$Ntot<-temp$Ntot/temp$Ntot[1]
# matplot(rownames(temp),temp,type='l',lty=1,lwd=2,ylab="",xlab="")
# abline(h=1)
# abline(v=59,col=1)
# grid()
# legend("bottomleft",col=1:6,lwd=2,bty='n',legend=colnames(temp))
```

As previously, employment dynamics are driven by output dynamics. we however witness a replacement of brown employment by green one, while consumption never completely recovers to its pre-crisis level.

```{r, echo=FALSE}
temp<-bas[41:53,c("Nc","Nh","Nl")]
#draw chart
stackpoly(temp,stack=T,xaxlab=rownames(temp),ylim=c(550,1000))
#add legend
legend("bottomleft",c("Nc","Nh","Nl"),fill=rainbow(dim(prop_table)[2]),bty='n')
```

#### Capital income

Most of the consumption out of capital income and wealth is driven by income dynamics where capital gains and wealth dynamics seem to be either constant (wealth) or have little impact.

```{r, echo=FALSE}
temp<-bas[40:53,c("ydfe","xif1","xif2","xif3","cg","vf")]
temp$ydfe<-temp$xif1*temp$ydfe
temp$vf<-c(NA,temp$xif2[-14]*temp$vf[-14])
# temp$cg<-1+temp$cg/(10e14*temp$cg[1])
temp$cg<-c(NA,temp$xif3[-14]*temp$cg[-14])
temp<-temp[-1,c("ydfe","vf","cg")]
stackpoly(temp,stack=T,xaxlab=rownames(temp),ylim=c(0,27))
#add legend
legend("bottomleft",c("ydfe","vf","cg"),fill=rainbow(dim(temp)[2]),bty='n')
# prop_table <- prop.table(as.matrix(temp),1)
# stackpoly(100*prop_table,stack=T,xaxlab=rownames(temp))
# legend("bottomleft",c("ydce","vc","cg"),fill=rainbow(dim(temp)[2]),bty='n')
```

Capital income shows relatively stable banks dividends with large fluctuation of the three other sources of dividends.

```{r, echo=FALSE}
temp<-bas[41:53,c("FDb","FDc","FDh","FDl")]
#create proportions table
#prop_table <- prop.table(as.matrix(temp),1)
#draw chart
stackpoly(temp,stack=T,xaxlab=rownames(temp))
#add legend
legend("topright",c("FDb","FDc","FDh","FDl"),fill=rainbow(dim(temp)[2]),bty='n')
```

# Recovery after bankrupcy


## Green sector

Once the brown sector exit all markets, the financial crisis hits the two remaining sectors. 

```{r, echo=FALSE}
temp<-bas[21:80,c("pce","phe","ple")]
matplot(rownames(temp),temp,type='l',lty=1,lwd=2,ylab="",xlab="")
abline(h=1)
abline(v=40,col=1)
abline(v=53,col=1)
legend("bottomleft",col=1:5,lwd=2,bty='n',legend=colnames(temp))
```

This leads to a long phase of decrease in growth (until negative values), partially compensated by high capacity utilisation at first. It is only when the Tobin's q recovers and tends towards 1 that the growth rate recovers into positive values.

```{r, echo=FALSE}
temp<-bas[53:150,c("lambdalprev","rintrl","qlprev","ule","intrl","eta2","eta1","eta3","eta0k","gkl")]
temp$debtburden<--temp$eta2*temp$rintrl*temp$lambdalprev
temp$capacity<-temp$eta1*temp$ule
temp$finance<-temp$eta3*temp$qlprev
matplot(rownames(temp),temp[c("debtburden","capacity","finance","gkl")],col=2:5,type='l',lty=1,lwd=2,main="factors of green growth",xlab="",ylab="")
abline(h=0,col=1)
abline(v=53,col=1)
grid()
legend("center",col=2:5,lwd=2,bty='n',legend=c("debtburden","capacity","finance","growth"))
```

Note that inflation is such around period 65 that real interest rates become negative (fixed nominal rates), which helps recovering positive growth rates. Inflation is high in the green sector due to massive underutilisation of capital, which is compensated by high park-ups to maintain return rates on capital. As soon as capacity utilisation recovers, inflation decreases.

```{r, echo=FALSE}
temp<-bas[53:150,c("pkl","upsilonl","yle","UCle")]
temp$pkl<-temp$pkl/temp$pkl[1]
temp$upsilonl<-temp$upsilonl/temp$upsilonl[1]
temp$yle<-temp$yle/temp$yle[1]
temp$UCle<-temp$UCle/temp$UCle[1]
matplot(rownames(temp),temp,type='l',lty=1,lwd=2,ylab="",xlab="")
abline(v=53,col=1)
legend("bottomleft",col=1:5,lwd=2,bty='n',legend=c("pl","upsilonl","yle","UCle"))
```

## Consumption sector

### Before financial entry of green sector

The consumption sector Tobin's q was already such as to imply negative growth values in the consumption sector. Te rapid inflation of the capital goods allows to clean the sectorial balance sheets as their assets increase in price, leading to an improvment of the Tobin's q and to positive growth rates.

```{r, echo=FALSE}
temp<-bas[53:150,c("lambdacprev","rintrc","qcprev","uce","intrc","eta2","eta1","eta3","eta0c","gc")]
temp$debtburden<--temp$eta2*temp$rintrc*temp$lambdacprev
temp$capacity<-temp$eta1*temp$uce
temp$finance<-temp$eta3*temp$qcprev
matplot(rownames(temp),temp[c("debtburden","capacity","finance","gc")],col=2:5,type='l',lty=1,lwd=2,main="factors of consumption growth",xlab="",ylab="")
abline(h=0,col=1)
abline(v=59,col=1)
grid()
legend("center",col=2:5,lwd=2,bty='n',legend=c("debtburden","capacity","finance","growth"))
```

In terms of output, most of the fluctuations come from the consumption out of labor income, with minor fluctuations out of consumption out of capital income (also because it represent a smaller share: `r 100*mean(bas$cf[59:80]/bas$yc[59:80])`%)

```{r, echo=FALSE}
temp<-bas[53:150,c("yc","cf","cw")]
temp$yc<-temp$yc/temp$yc[1]
temp$cf<-temp$cf/temp$cf[1]
temp$cw<-temp$cw/temp$cw[1]
matplot(rownames(temp),temp,type='l',lty=1,lwd=2,ylab="",xlab="")
abline(h=1)
abline(v=53,col=1)
legend("bottomleft",col=1:5,lwd=2,bty='n',legend=colnames(temp))
```

#### Consumption out of labor income

Completely driven by expected income which somewhat smoothes out the fluctuation in observed disposable income (mimics the employment dynamics mitigated by inflationary effects on wealth).

```{r, echo=FALSE}
temp<-bas[53:150,c("cw","ydwe","pc","ydw","Ntot")]
temp$ydwe<-temp$ydwe/temp$ydwe[1]
temp$cw<-temp$cw/temp$cw[1]
temp$pc<-temp$pc/temp$pc[1]
temp$ydw<-temp$ydw/temp$ydw[1]
temp$Ntot<-temp$Ntot/temp$Ntot[1]
matplot(rownames(temp),temp,type='l',lty=1,lwd=2,ylab="",xlab="")
abline(h=1)
abline(v=53,col=1)
grid()
legend("bottomleft",col=1:6,lwd=2,bty='n',legend=colnames(temp))
```

Employment dynamics are driven by output decision with a long decrease in the consumption sector which slowly recovers, and with a rapid decrease in the green sector followed by a medium-length recovery.

```{r, echo=FALSE}
temp<-bas[53:150,c("Nc","Nl")]
#draw chart
stackpoly(temp,stack=T,xaxlab=rownames(temp),ylim=c(0,1000))
#add legend
legend("bottomleft",c("Nc","Nl"),fill=rainbow(dim(temp)[2]),bty='n')
```

#### Capital income

Consumption out of capital income is at first depressed by the bail-in (due to non-performing loans in the capital sector) and negative capital gains but as dividends levels recover and capital gains turn positive again, the wealth effects on capital income consumption recover, leading to higher levels of consumption.

```{r, echo=FALSE}
temp<-bas[53:150,c("ydfe","xif1","xif2","xif3","cg","vf")]
temp$ydfe<-temp$xif1*temp$ydfe
temp$vf<-c(NA,temp$xif2[-98]*temp$vf[-98])
# temp$cg<-1+temp$cg/(10e14*temp$cg[1])
temp$cg<-c(NA,temp$xif3[-98]*temp$cg[-98])
temp<-temp[-1,c("ydfe","vf","cg")]
stackpoly(temp,stack=T,xaxlab=rownames(temp),ylim=c(0,27))
#add legend
legend("bottomleft",c("ydfe","vf","cg"),fill=rainbow(dim(temp)[2]),bty='n')
# prop_table <- prop.table(as.matrix(temp),1)
# stackpoly(100*prop_table,stack=T,xaxlab=rownames(temp))
# legend("bottomleft",c("ydce","vc","cg"),fill=rainbow(dim(temp)[2]),bty='n')
```

Capital income shows a rapid recovery of banks dividends (which were depressed due to non-performing loans in the brown sector) and a rapid increase of consumption dividends (due to low level of investment and negative capital gains).When consumption goods dividends decrease, green capital goods dividends increase, again due to low investment levels in that sector (and hence less need for retained earnings).

```{r, echo=FALSE}
temp<-bas[53:150,c("FDb","FDc","FDl")]
#create proportions table
#draw chart
stackpoly(temp,stack=T,xaxlab=rownames(temp),ylim=c(0,3400))
#add legend
legend("topright",c("FDb","FDc","FDl"),fill=rainbow(dim(temp)[2]),bty='n')
# matplot(rownames(temp),temp,type='l',lty=1,lwd=2,ylab="",xlab="")
# abline(h=1)
# abline(v=59,col=1)
# legend("bottomleft",col=1:6,lwd=2,bty='n',legend=c("FDb","FDc","FDk","FDi"))
```


# Overall dynamic of GDP
The overall dynamics of GDP over the entire transition shows two mild recessions followed by two booms (the first one driven by real dynamics between brown and consumption and the second one fueled by finance and its impact on investment and consumption). After the exit of the brown sector, GDP shows a rapid recession, particularly in the capital good sector followed by a long recovery. The dynamics in consumption are slower but similar.

```{r, echo=FALSE}
temp<-bas[1:150,c("Yc","Yh","Yl")]
df.bar<-barplot(t(as.matrix(temp)), main="", xlab="",ylim=c(0,max(rowSums(temp))), border="white", col=c("lightblue","lightcoral","lightgreen"))
temp$GDP<-temp$Yc+temp$Yh+temp$Yl
lines(df.bar,temp$GDP, lty=1,lwd=1)
abline(v=df.bar[21],col=2,lwd=1,lty=2)
abline(v=df.bar[41],col=2,lwd=1,lty=3)
abline(v=df.bar[53],col=2,lwd=1)
legend("bottomright", legend=c("Consumption","High-Carbon","Low-Carbon", "GDP"), col=c("lightblue","lightcoral","lightgreen",1), fill=c("lightblue","lightcoral","lightgreen",NA),lty=c(NA,NA,NA,1), border="white",x.intersp = c(0.6,0.6,0.6,1.2),seg.len = c(1,1,1,1))
legend(x=68,y=15000, legend=c("Crisis 1","Crisis 2","Crisis 3"), col=2, lty=c(2,3,1),bty='n')

#add legend

temp$Yhgr<-c(NA,(temp$Yh[-1]-temp$Yh[-150])/temp$GDP[-150])
temp$Ycgr<-c(NA,(temp$Yc[-1]-temp$Yc[-150])/temp$GDP[-150])
temp$Ylgr<-c(NA,(temp$Yl [-1]-temp$Yl[-150])/temp$GDP[-150])
temp$GDPgr<-c(NA,(temp$GDP[-1]-temp$GDP[-150])/temp$GDP[-150])
temppos<-temp[21:150,c("Ycgr","Yhgr","Ylgr")]
temppos[temppos<0]<-0
tempneg<-temp[21:150,c("Ycgr","Yhgr","Ylgr")]
tempneg[tempneg>0]<-0

png(filename=paste("plots/final/baselineGDP.png",sep=""),width=1440,height=960,pointsize = 20)
df.bar<-barplot(t(as.matrix(temppos)), main="", xlab="",ylim=round(c(min(rowSums(tempneg)),max(rowSums(temppos))),digit=2), border="white", col=c("lightblue","lightcoral","lightgreen"))
df.bar<-barplot(t(as.matrix(tempneg)), main="", xlab="", add=TRUE, border="white", col=c("lightblue","lightcoral","lightgreen"), axes=F)
points(x = df.bar, y=temp$GDPgr[21:150],lwd=1,pch=5)
abline(v=mean(df.bar[21:22]),col=2,lwd=1,lty=2)
abline(v=mean(df.bar[33:34]),col=2,lwd=1,lty=3)
legend("bottomleft", legend=c("Consumption","High-Carbon","Low-Carbon"), bty='n', col=c("lightblue","lightcoral","lightgreen"), fill=c("lightblue","lightcoral","lightgreen"), border="white")
legend(x=-2,y=-0.086,legend=c("GDP"),bty='n',col=c(1),pch=5,x.intersp = 1.3)
dev.off()
```

The three recession correspond to financial crisis. All these crisis are different in quality and quantity. The first one is symetric shock, positive for the consumption sector and negative for the brown sector, due to the emergence of the green sector, it thus lags the real dynamics. The Second shock hits both the consumption and brown sector as the green sector enters the financial market. Finally, the last shock hits the two remaining sectors. The last two recession are thus created by the financial markets.

```{r, echo=FALSE}
png(filename=paste("plots/final/baselineEquityPrice.png",sep=""),width=1440,height=960,pointsize = 20)
temp<-bas[21:75,c("pce","phe","ple")]
matplot(rownames(temp),temp,type='o',lty=1,lwd=2,ylab="",xlab="",pch=c(2:4))
abline(h=1)
abline(v=40,col=2,lty=2)
abline(v=53,col=2,lty=3)
grid()
legend(x=20,y=25,pch=c(2:4),col=1:5,lwd=2,bty='n',legend=c("Consumption Equity","High-Carbon Equity","Low-Carbon Equity"))
dev.off()
```
